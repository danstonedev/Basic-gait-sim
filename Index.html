<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simple Gait Simulator (Sagittal)</title>
<style>
  :root {
    --bg:#0f172a; --panel:#111827; --ink:#e5e7eb; --muted:#9ca3af; --accent:#10b981;
  }
  html,body {height:100%; margin:0; background:var(--bg); color:var(--ink); font:14px/1.3 system-ui,Segoe UI,Roboto,Arial;}
  .wrap {max-width:1000px; margin:auto; padding:16px; display:grid; gap:12px;}
  h1 {font-size:20px; margin:0 0 4px;}
  .toolbar {display:grid; grid-template-columns:1fr 1fr; gap:12px;}
  .controls, .notes {background:var(--panel); border-radius:10px; padding:12px;}
  .controls h2 {font-size:14px; margin:0 0 8px; color:var(--muted);}
  .row {display:grid; grid-template-columns:160px 1fr 60px; gap:10px; align-items:center; margin:6px 0;}
  input[type=range] {width:100%;}
  select, button {background:#0b1220; color:var(--ink); border:1px solid #1f2937; border-radius:8px; padding:6px 10px;}
  button.primary {background:var(--accent); color:#04110d; border:none; font-weight:600}
  canvas {width:100%; height:360px; background:#0b1220; border-radius:10px; display:block}
  .legend {display:flex; gap:12px; font-size:12px; color:var(--muted)}
  .badge {display:inline-flex; align-items:center; gap:6px}
  .dot {width:10px; height:10px; border-radius:50%}
  .footprint {position:relative; height:10px}
  .footprint::before {content:""; position:absolute; inset:0; background:
    repeating-linear-gradient(90deg, transparent, transparent 30px, #1f2937 31px);
    opacity:.6}
  small {color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <div>
      <h1>Simple Gait Simulator</h1>
      <div class="legend">
        <span class="badge"><span class="dot" style="background:#93c5fd"></span>Left</span>
        <span class="badge"><span class="dot" style="background:#fca5a5"></span>Right</span>
        <span class="badge">GRF arrow shows during stance</span>
      </div>
    </div>

    <canvas id="view" width="1000" height="360" aria-label="Gait animation canvas"></canvas>
    <div class="footprint"></div>

    <div class="toolbar">
      <div class="controls">
        <h2>Parameters</h2>
        <div class="row">
          <label for="cadence">Cadence (steps/min)</label>
          <input id="cadence" type="range" min="60" max="140" step="1" value="100">
          <output id="cadenceOut">100</output>
        </div>
        <div class="row">
          <label for="step">Step length (m)</label>
          <input id="step" type="range" min="0.40" max="0.90" step="0.01" value="0.65">
          <output id="stepOut">0.65</output>
        </div>
        <div class="row">
          <label for="stance">Stance phase (%)</label>
          <input id="stance" type="range" min="45" max="70" step="1" value="60">
          <output id="stanceOut">60</output>
        </div>
        <div class="row">
          <label for="height">Body height (m)</label>
          <input id="height" type="range" min="1.40" max="1.95" step="0.01" value="1.75">
          <output id="heightOut">1.75</output>
        </div>
        <div class="row">
          <label for="preset">Preset</label>
          <select id="preset">
            <option value="normal" selected>Normal</option>
            <option value="antalgicL">Antalgic (↓ L stance)</option>
            <option value="antalgicR">Antalgic (↓ R stance)</option>
            <option value="trendelenburgL">Trendelenburg (L drop)</option>
            <option value="trendelenburgR">Trendelenburg (R drop)</option>
            <option value="circumductionL">Circumduction (L)</option>
            <option value="circumductionR">Circumduction (R)</option>
          </select>
          <button id="reset">Reset</button>
        </div>
        <div class="row">
          <label>Playback</label>
          <button id="play" class="primary">Play</button>
          <button id="pause">Pause</button>
        </div>
        <div class="row">
          <label>Derived speed</label>
          <div><small id="speed">—</small></div>
        </div>
      </div>

      <div class="notes">
        <h2>Teaching Notes</h2>
        <ul>
          <li>Adjust cadence, step length, stance% to explore relationships.</li>
          <li>Presets demonstrate classic gait deviations.</li>
          <li>GRF arrow appears only during stance.</li>
          <li>Angles are smooth sine templates—use to discuss ranges & timing.</li>
        </ul>
      </div>
    </div>

    <small>Educational approximation (not clinical quantification).</small>
  </div>

<script>
(() => {
  const canvas = document.getElementById('view');
  const ctx = canvas.getContext('2d');

  // UI
  const cadence = document.getElementById('cadence');
  const step = document.getElementById('step');
  const stance = document.getElementById('stance');
  const height = document.getElementById('height');
  const cadenceOut = document.getElementById('cadenceOut');
  const stepOut = document.getElementById('stepOut');
  const stanceOut = document.getElementById('stanceOut');
  const heightOut = document.getElementById('heightOut');
  const speedOut = document.getElementById('speed');
  const preset = document.getElementById('preset');
  const playBtn = document.getElementById('play');
  const pauseBtn = document.getElementById('pause');
  const resetBtn = document.getElementById('reset');

  let running = false, t=0, last=performance.now();

  const P = {cadence:100, stepLen:0.65, stancePct:60, height:1.75,
             pelvisDropL:0, pelvisDropR:0, circumductionL:0, circumductionR:0};

  function updateOutputs() {
    cadenceOut.textContent=P.cadence;
    stepOut.textContent=P.stepLen.toFixed(2);
    stanceOut.textContent=P.stancePct;
    heightOut.textContent=P.height.toFixed(2);
    const v=(P.cadence*P.stepLen)/60;
    speedOut.textContent=v.toFixed(2)+" m/s";
  }

  function segs(){const H=P.height; return{thigh:0.245*H,shank:0.246*H,foot:0.152*H,pelvisW:0.19*H};}

  function jointAngles(phase){
    const φ=phase%1;
    const hip=15+15*Math.sin(2*Math.PI*(φ-0.05));
    const knee=10+25*Math.sin(2*Math.PI*(φ+0.15))+25*Math.max(0,Math.sin(2*Math.PI*(φ+0.15))**3);
    const swingBump=35*Math.max(0,Math.sin(2*Math.PI*(φ+0.35)));
    const kneeDeg=Math.min(65,knee+swingBump);
    const ankle=-5+10*Math.sin(2*Math.PI*(φ-0.05))-10*Math.sin(4*Math.PI*(φ-0.05));
    return {hip:hip,knee:kneeDeg,ankle:ankle};
  }

  function stanceWindow(p){return (p%1)<(P.stancePct/100);}

  function applyPreset(name){
    P.pelvisDropL=P.pelvisDropR=0; P.circumductionL=P.circumductionR=0;
    if(name==='antalgicL')P.stancePct=55;
    if(name==='antalgicR')P.stancePct=55;
    if(name==='trendelenburgL')P.pelvisDropL=6;
    if(name==='trendelenburgR')P.pelvisDropR=6;
    if(name==='circumductionL')P.circumductionL=0.05;
    if(name==='circumductionR')P.circumductionR=0.05;
  }

  function drawFrame(dt){
    if(running)t+=dt;
    const stepHz=P.cadence/60, strideHz=stepHz/2;
    const phaseR=(t*strideHz)%1, phaseL=(phaseR+0.5)%1;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const groundY=canvas.height-40, m2px=260, vx=(P.cadence*P.stepLen/60)*m2px;
    const x0=80+vx*t, S=segs(), pelvisY=groundY-(S.thigh+S.shank)*0.92, pelvisX=x0%(canvas.width+400);
    ctx.strokeStyle='#1f2937'; ctx.beginPath(); ctx.moveTo(0,groundY); ctx.lineTo(canvas.width,groundY); ctx.stroke();

    function leg(side,phase,color){
      const ang=jointAngles(phase); const d2r=Math.PI/180;
      const hipX=pelvisX+(side==='R'?+S.pelvisW*0.5:-S.pelvisW*0.5)*m2px/P.height, hipY=pelvisY;
      const hx=hipX,hy=hipY, kx=hx+S.thigh*m2px*Math.cos(-ang.hip*d2r), ky=hy+S.thigh*m2px*Math.sin(-ang.hip*d2r);
      const ax=kx+S.shank*m2px*Math.cos(-(ang.hip-ang.knee)*d2r), ay=ky+S.shank*m2px*Math.sin(-(ang.hip-ang.knee)*d2r);
      const fx=ax+S.foot*m2px*Math.cos(-(ang.hip-ang.knee+ang.ankle)*d2r), fy=ay+S.foot*m2px*Math.sin(-(ang.hip-ang.knee+ang.ankle)*d2r);
      ctx.strokeStyle=color; ctx.lineWidth=4; ctx.beginPath(); ctx.moveTo(hx,hy); ctx.lineTo(kx,ky); ctx.lineTo(ax,ay); ctx.lineTo(fx,fy); ctx.stroke();
      if(stanceWindow(phase)){ctx.strokeStyle='#34d399';ctx.beginPath();ctx.moveTo(ax,groundY);ctx.lineTo(ax,groundY-40);ctx.stroke();}
    }

    ctx.strokeStyle='#e5e7eb'; ctx.lineWidth=6; ctx.beginPath();
    ctx.moveTo(pelvisX-S.pelvisW*0.5*m2px/P.height,pelvisY);
    ctx.lineTo(pelvisX+S.pelvisW*0.5*m2px/P.height,pelvisY); ctx.stroke();

    leg('L',phaseL,'#93c5fd'); leg('R',phaseR,'#fca5a5');
  }

  function tick(now){const dt=Math.min(0.05,(now-last)/1000);last=now;drawFrame(dt);requestAnimationFrame(tick);} requestAnimationFrame(tick);

  cadence.oninput=()=>{P.cadence=+cadence.value;updateOutputs();};
  step.oninput=()=>{P.stepLen=+step.value;updateOutputs();};
  stance.oninput=()=>{P.stancePct=+stance.value;updateOutputs();};
  height.oninput=()=>{P.height=+height.value;updateOutputs();};
  preset.onchange=()=>{applyPreset(preset.value);updateOutputs();};
  resetBtn.onclick=()=>{cadence.value=100;step.value=0.65;stance.value=60;height.value=1.75;preset.value='normal';applyPreset('normal');updateOutputs();};
  playBtn.onclick=()=>{running=true;}; pauseBtn.onclick=()=>{running=false;};

  updateOutputs(); applyPreset('normal');
})();
</script>
</body>
</html>
